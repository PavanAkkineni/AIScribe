<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Recording - AIscribe</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='record.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='chat-assistant.css') }}">
</head>
<body>
    <!-- Header -->
    <header class="main-header">
        <div class="header-left">
            <div class="logo">
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
                    <circle cx="20" cy="20" r="18" fill="#2563eb" stroke="#fff" stroke-width="2"/>
                    <path d="M15 20 L18 23 L25 16" stroke="#fff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span class="logo-text">AIscribe<sup>â„¢</sup></span>
            </div>
        </div>
        <nav class="header-nav">
            <a href="#">Blog</a>
            <a href="/" class="active">Recordings</a>
            <a href="#">Templates</a>
            <a href="#">Account</a>
            <a href="/logout">Logout</a>
        </nav>
    </header>

    <!-- Trial Banner -->
    <div class="trial-banner">
        <div class="trial-content">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="12" r="10" stroke="white" stroke-width="2"/>
                <path d="M12 6v6l4 2" stroke="white" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <span class="trial-text">AIscribe Advanced Trial</span>
        </div>
        <div class="trial-progress">
            <div class="progress-bar">
                <div class="progress-fill" style="width: 70%;"></div>
            </div>
            <span class="trial-days">9 days remaining in your trial</span>
        </div>
        <button class="btn-choose-plan">Choose a Plan</button>
    </div>

    <!-- Main Content -->
    <div class="record-content">
        <!-- Back Button -->
        <button class="btn-back" onclick="window.location.href='/'">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M19 12H5M5 12l7 7M5 12l7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Back
        </button>

        <!-- Patient Info & Recording Header -->
        <div class="recording-header-info">
            <div>
                <h1 class="patient-title" id="patientName">{{ patient_id }}</h1>
                <p class="recording-date" id="recordingDate"></p>
            </div>
            <div class="recording-status-badge">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="12" r="10" stroke="#3b82f6" stroke-width="2"/>
                </svg>
                <span id="durationBadge">0 mins</span>
            </div>
            <button class="btn-upload-offline" onclick="document.getElementById('fileInput').click()">
                Upload Offline Recording
            </button>
        </div>

        <!-- Instructions -->
        <div class="instructions-box">
            <p>Press record, then press stop when done. Press Finalize, you are prompted to choose from many desired elements. AI will add to the note. Submit - new note in a few seconds, available for 30 days</p>
            <p>To test your microphone and speaker, press the button below. Check your audio input level to verify microphone and system functionality. For non-English languages, visit the language settings page.</p>
        </div>

        <!-- Recording Section (Initial State) -->
        <div id="recordingSection" class="recording-section">
            <div class="mic-button-container">
                <button class="mic-button-large" id="micButton">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="white">
                        <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                        <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                    </svg>
                </button>
            </div>
            <p class="recording-instruction" id="recordingStatus">Click to start recording</p>
            
            <!-- Audio Preview -->
            <div id="audioPreview" style="display: none;">
                <audio id="audioPlayer" controls style="width: 100%; max-width: 500px;"></audio>
            </div>

            <!-- Submit Button -->
            <button class="btn-submit" id="submitBtn" style="display: none;">
                Submit & Process
            </button>

            <!-- Hidden file input -->
            <input type="file" id="fileInput" accept="audio/*,.wav,.mp3,.mp4,.m4a,.flac,.ogg,.webm" style="display: none;">
        </div>

        <!-- Processing State -->
        <div id="processingSection" style="display: none;">
            <div class="processing-spinner">
                <div class="spinner"></div>
                <p>Processing your recording...</p>
                <p class="processing-step" id="processingStep">Transcribing audio...</p>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" style="display: none;">
            <!-- Conversation Transcript -->
            <div class="content-section">
                <h2 class="section-title">Conversation Transcript</h2>
                <div class="transcript-box" id="transcriptContent"></div>
            </div>

            <!-- Clinical Summary -->
            <div class="content-section">
                <h2 class="section-title">Clinical Summary</h2>
                
                <div class="summary-card">
                    <h3>Chief Complaint</h3>
                    <p id="chiefComplaint"></p>
                </div>

                <div class="summary-card">
                    <h3>History of Present Illness</h3>
                    <p id="historyPresentIllness"></p>
                </div>

                <div class="summary-card">
                    <h3>Assessment/Plan</h3>
                    <p id="assessmentPlan"></p>
                </div>
            </div>

            <!-- MDM & Coding -->
            <div class="content-section">
                <div class="tabs">
                    <button class="tab-btn active" data-tab="mdm">MDM & CODING</button>
                    <button class="tab-btn" data-tab="guidelines">Suggested Guidelines</button>
                </div>

                <div class="tab-content active" id="mdm-tab">
                    <div class="mdm-box" id="mdmContent"></div>
                </div>

                <div class="tab-content" id="guidelines-tab">
                    <div class="guidelines-box">
                        <p>Suggested guidelines will appear here.</p>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn-action" onclick="saveAndReturn()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z" stroke="currentColor" stroke-width="2"/>
                        <polyline points="17 21 17 13 7 13 7 21" stroke="currentColor" stroke-width="2"/>
                        <polyline points="7 3 7 8 15 8" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    Save & Return to Recordings
                </button>
                <button class="btn-action" onclick="window.print()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path d="M6 9V2h12v7M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2" stroke="currentColor" stroke-width="2"/>
                        <rect x="6" y="14" width="12" height="8" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    Print
                </button>
            </div>
        </div>
    </div>

    <script>
        const patientId = "{{ patient_id }}";
        const patientName = "{{ patient_id }}";
    </script>
    <script src="{{ url_for('static', filename='record.js') }}"></script>
    <script src="{{ url_for('static', filename='chat-assistant.js') }}"></script>
</body>
</html>

